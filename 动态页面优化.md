## 动态页面优化

### 一 . 减少请求

我们说的请求其实就包含了两种：数据库操作和接口操作，前端性能最耗时的就在这些网络交互上，所以我们要尽可能的减少请求数，来提高前端操作性能。

适合的场景：

1. 合理使用全局缓存，很多码表数据，在全局只需要加载一次，后续只需要从前端缓存中获取，而不是每次都需要加载一次
2. 合并sql，有些数据可以通过一句sql都查询出来，那就不要配置成多条sql
3. 通过服务器命令或者自己编写groovy接口，实现多条业务逻辑数据库交互，都在后台接口里执行，让前端与后端只有一次接口交互
4. 在所有可能出现循环的地方，都要考虑是不是会造成循环请求，比如xitem或者自己脚本里的for循环



### 二. 异步请求

如果一个接口调用或者一个数据库查询，和命令后续结果是无关的，那就很适合改成异步模式，让主线程继续执行，网络请求通过异步回调来实现结果处理。

异步请求还有并发执行的好处，chrome浏览器单个域名最大支持6个并发，也可以提高加载速度。

PC版所有数据库和接口都支持异步模式（默认是同步的），如果使用同步模式，那整个页面加载顺序就是线性串行的，如果加载一个页面有10个组件，每个组件加载里有5个请求，每次请求耗时20ms，那么加载完就等于10 * 5 * 20 =1000ms 一秒钟就消耗掉了，更别说中间哪个请求卡一下。如果这时候去修改这10个组件，发现里面5个请求中，有2个是前后相关的，有3个是前后无关的，那我们就可以把这2个都改成异步处理，异步处理后，浏览器就不会等待接口返回直接继续往下执行下去，也就是意味着 10 * (5-3) * 20 = 400ms，这就大大加快了页面加载速度，虽然有些请求还没完成返回，但页面已经加载完毕。

适合的场景：

1. 页面或者组件加载时候，如果有前后不相干的sql或者接口，就可以用异步模式
2. 页面上所有定时任务的接口交互都应该是异步的，避免页面的卡顿现象
3. 高级用法，异步类库Async，可以实现多个异步任务同时执行，然后获取所有异步任务的结果后下一步再接着执行（手机端用的较多）



### 三. 其他优化经验

1. 使用fiddler对自己做的动态页面做请求拦截，可以分析每个请求是否合理，是否有优化的空间
2. 合理使用组件，组件虽然有强大的复用性，但其加载流程和一个动态页面一致，会有较复杂的逻辑（结构加载，整个组件生命周期回调），如果对性能要求高的地方需要注意不要滥用

